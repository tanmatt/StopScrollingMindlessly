#!/usr/bin/env python3
"""
Generate JPEG screenshots from HTML mockups
Requires: pip install playwright
Then run: playwright install chromium
"""

import os
import zipfile
from playwright.sync_api import sync_playwright

def generate_jpeg(html_file, output_file, width=1280, height=800):
    """Generate JPEG from HTML file using Playwright"""
    with sync_playwright() as p:
        browser = p.chromium.launch()
        page = browser.new_page(viewport={'width': width, 'height': height})
        
        file_path = os.path.abspath(html_file)
        page.goto(f'file://{file_path}')
        
        # Wait for any animations
        page.wait_for_timeout(1000)
        
        # Screenshot as JPEG
        page.screenshot(path=output_file, type='jpeg', quality=85, full_page=False)
        
        browser.close()
    
    print(f'Created {output_file}')

def create_zip(screenshot_dir, zip_path):
    """Create zip file of all JPEG screenshots"""
    with zipfile.ZipFile(zip_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
        for root, dirs, files in os.walk(screenshot_dir):
            for file in files:
                if file.endswith('.jpg'):
                    file_path = os.path.join(root, file)
                    arcname = os.path.join('screenshots', file)
                    zipf.write(file_path, arcname)
                    print(f'Added {arcname} to zip')
    
    print(f'\nCreated zip file: {zip_path}')

if __name__ == '__main__':
    screenshot_dir = os.path.dirname(os.path.abspath(__file__))
    os.chdir(screenshot_dir)
    
    html_files = [
        ('screenshots/screenshot1.html', 'screenshots/screenshot1.jpg'),
        ('screenshots/screenshot2.html', 'screenshots/screenshot2.jpg'),
        ('screenshots/screenshot3.html', 'screenshots/screenshot3.jpg'),
        ('screenshots/screenshot4.html', 'screenshots/screenshot4.jpg'),
        ('screenshots/screenshot5.html', 'screenshots/screenshot5.jpg'),
    ]
    
    print('Generating JPEG screenshots...')
    for html_file, jpg_file in html_files:
        generate_jpeg(html_file, jpg_file)
    
    print('\nCreating zip file...')
    create_zip('screenshots', 'chrome-web-store-assets.zip')
    
    print('\nDone! Upload chrome-web-store-assets.zip to Chrome Web Store.')
